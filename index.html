<!DOCTYPE html>
<html>
<head>
    <title>sandsite</title>
    <style>
        .neon-text {
            font-size: 80px;
            color: #fff;
            font-family: 'Brush Script MT', cursive;
            font-style: italic;
            text-align: center;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #0073e6, 0 0 20px #0073e6, 0 0 25px #0073e6, 0 0 30px #0073e6, 0 0 35px #0073e6;
        }
        body { background-color: #111111; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    </style>
</head>
<body>
    <h1 class="neon-text" id="status">Loading...</h1>

    <script type="module">
        // Import WASI directly from a module-friendly CDN
        import { WASI } from 'https://cdn.jsdelivr.net/npm/@wasmer/wasi@1.2.2/+esm';

        async function runWasm() {
            const statusElement = document.getElementById('status');
            
            try {
                // Initialize WASI
                const wasi = new WASI({
                    args: [],
                    env: {},
                });

                // Fetch your WASM file
                const response = await fetch('./powder.wasm');
                if (!response.ok) throw new Error("Could not find powder.wasm file");
                
                const binary = await response.arrayBuffer();
                
                // Create the import object with the WASI requirements
                const importObject = {
                    wasi_snapshot_preview1: wasi.wasiImport
                };

                // Instantiate
                const { instance } = await WebAssembly.instantiate(binary, importObject);

                // Start the WASI runtime (required for wasm32-wasi targets)
                wasi.start(instance);

                // Try to call your function
                if (instance.exports.add) {
                    const result = instance.exports.add(10, 50);
                    statusElement.textContent = "Result: " + result;
                } else {
                    statusElement.textContent = "Wasm Ready!";
                    console.log("Available Exports:", Object.keys(instance.exports));
                }

            } catch (error) {
                statusElement.textContent = "Load Error";
                console.error("Wasm/WASI Error:", error);
            }
        }

        runWasm();
    </script>
</body>
</html>
